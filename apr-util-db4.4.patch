--- apr-util-1.2.2/build/dbm.m4.orig	2005-02-24 11:23:34.000000000 +0100
+++ apr-util-1.2.2/build/dbm.m4	2005-12-22 23:24:11.199447808 +0100
@@ -445,6 +445,25 @@
     apu_db_version=4
   fi
 ])
+dnl
+dnl APU_CHECK_DB44: is DB4.4 present?
+dnl
+dnl if present: sets apu_db_header, apu_db_lib, and apu_db_version
+dnl
+AC_DEFUN([APU_CHECK_DB44], [
+  places=$1
+  if test -z "$places"; then
+    places="std /usr/local/BerkeleyDB.4.4 /boot/home/config"
+  fi
+  APU_CHECK_BERKELEY_DB("4", "4", "-1",
+    "$places",
+    "db44/db.h db4/db.h db.h",
+    "db-4.4 db4-4.4 db44 db4 db"
+  )
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+])
 
 
 AC_DEFUN([APU_CHECK_DB], [
@@ -506,6 +525,12 @@
       AC_MSG_ERROR(Berkeley db4 not found)
     fi
     ;;
+  db43)
+    APU_CHECK_DB44("$check_places")
+    if test "$apu_db_version" != "4"; then
+      AC_MSG_ERROR(Berkeley db4 not found)
+    fi
+    ;;
   default)
     APU_CHECK_DB_ALL("$check_places")
     ;;
@@ -513,11 +538,13 @@
 ])
 
 dnl
-dnl APU_CHECK_DB_ALL: Try all Berkeley DB versions, from 4.3 to 1.
+dnl APU_CHECK_DB_ALL: Try all Berkeley DB versions, from 4.4 to 1.
 dnl
 AC_DEFUN([APU_CHECK_DB_ALL], [
   all_places=$1
  
+  APU_CHECK_DB44("$all_places")
+  if test "$apu_db_version" != "4"; then
   APU_CHECK_DB43("$all_places")
   if test "$apu_db_version" != "4"; then
     APU_CHECK_DB42("$all_places")
@@ -540,6 +567,7 @@
       fi
     fi
   fi
+  fi
   AC_MSG_CHECKING(for Berkeley DB)
   if test "$apu_have_db" = "1"; then
     AC_MSG_RESULT(found db$apu_db_version)
